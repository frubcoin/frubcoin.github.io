<html><head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Special+Gothic+Expanded+One&display=swap" rel="stylesheet">
  <style>
* {
  font-family: "Special Gothic Expanded One", sans-serif;
}

body {
  margin: 0;
  overflow: hidden;
  font-family: "Special Gothic Expanded One", sans-serif;

}
.special-gothic-expanded-one-regular {
  font-family: "Special Gothic Expanded One", sans-serif;
  font-weight: 400;
  font-style: normal;
}


#background-canvas {
  position: absolute;
  left: 0;
  top: 0;
  width: 100vw; 
  height: 100vh;
  z-index: 0;
}

#data-window {

  letter-spacing: 0.065rem;
  position: absolute;
  top: 35vh;
  left: 50vw;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.7);
  border-radius: 0.9375rem;
  padding: 1.25rem;
  width: 90vw;
  max-width: 25.8rem;
  z-index: 2;
  text-align: center;
  box-shadow: 0 0.25rem 0.375rem rgba(0, 0, 0, 0.1), 0 0.0625rem 0.1875rem rgba(0, 0, 0, 0.08);
  backdrop-filter: blur(0.625rem);
  -webkit-backdrop-filter: blur(0.5rem);
  transition: background 0.3s ease;
  color: #fff;
}



#data-window.light-mode {
  background: rgba(255, 250, 250, 0.4);
  color: #000;
  scrollbar-track-color: ;
}

h2 {

  margin: 0 0 0.6rem;
  font-weight: 600;
  text-transform: uppercase;
  transition: color 0.3s ease;
}

.price-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 0 0 0.625rem;
  cursor: pointer;
  padding: 0.625rem;
  border-radius: 0.3125rem;
  transition: background-color 0.3s ease;
  user-select: none;
}

.price-container:hover {
  background-color: rgba(255, 255, 255, 0.1);
}

.price-container.selected {
  background-color: rgba(255, 255, 255, 0.2);
}

.live-ping {
  width: 0.625rem;
  height: 0.625rem;
  border-radius: 50%;
  background-color: #4CAF50;
  margin-right: 0.625rem;
  animation: ping 1s ease-in-out infinite;
  display: none;
}

@keyframes ping {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(2);
    opacity: 0;
  }
}

.price-ticker {
  margin-left: 0.625rem;
  font-size: 1.2em;
}

.up {
  color: #4CAF50;
}

.down {
  color: #FF5722;
}

h1 {
  margin: 0;
  font-weight: 600;
  transition: color 0.3s ease;
  font-size: 1.5em;
}

#price-history {
  font-size: 1.1em;
  max-height: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column-reverse;
  transition: max-height 0.3s ease-out;
  margin-top: 0.625rem;
}

#price-history.expanded {
  max-height: 12.5rem;
  overflow-y: auto;
}

#history-toggle {

  letter-spacing: 0.03125rem;
  background: none;
  border: none;
  color: #818181b9;
  cursor: pointer;
  padding: 0.3rem;
  margin-top: 0.6rem;
  font-size: 0.6em;
  opacity: 0.8;
  transition: opacity 0.3s ease;
}

#history-toggle:hover {
  opacity: 1;
}

.history-item {
  margin-bottom: 0.625rem;
  padding: 0.3125rem 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  transition: border-color 0.3s ease;
}

.light-mode .history-item {
  border-color: rgba(0, 0, 0, 0.1);
}

#background-select {
  letter-spacing: 0.03125rem;
    text-decoration: none;
  position: absolute;
  top: 0.625rem;
  right: 0.625rem;
  z-index: 2;
  padding: 0.375rem;
  font-size: 0.9em;
  border-radius: 0.625rem;
  background: rgba(51, 51, 51, 0.2);
  color: #ffffff;
  border: 1px solid rgba(255, 255, 255, 0.0);
  outline: none;
  cursor: pointer;
  backdrop-filter: blur(0.3125rem);
  -webkit-backdrop-filter: blur(0.3125rem);
}

#background-select option {
  background: #000;
  color: #fff;
}



.light-mode #background-select {
  background: rgba(255, 255, 255, 0.2);
  color: #000000;
  border: 1px solid rgba(0, 0, 0, 0.2);
}

.light-mode #background-select option {
  background: #fff;
  color: #000;
}

#dark-mode-toggle {
  letter-spacing: 0.03125rem;
  text-decoration: none;
  position: absolute;
  top: 0.625rem;
  left: 0.625rem;
  z-index: 2;
  padding: 0.375rem;
  font-size: 0.8em;
  border-radius: 0.625rem;
  background: rgba(51, 51, 51, 0.2);
  color: #ffffff;
  border: 1px solid rgba(255, 255, 255, 0.0);
  outline: none;
  cursor: pointer;
  backdrop-filter: blur(0.3125rem);
  -webkit-backdrop-filter: blur(0.3125rem);
}

.light-mode #dark-mode-toggle {
  background: rgba(255, 254, 254, 0.5);
  color: #000000;
  border: 1px solid rgba(0, 0, 0, 0.2);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 0.375rem;
}

::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.1); 
  border-radius: 0.625rem;
}
 
::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2); 
  border-radius: 0.625rem;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.4); 
}

@media (max-width: 600px) {
  html {
    overflow: hidden;
  }
  
  h1 {
    font-size: 1.2em;
  }

  .price-ticker {
    font-size: 1em;

  }

  #price-history {
    font-size: 1em;
  }

  #background-select,
  #dark-mode-toggle {
    font-size: 0.75em;
    padding: 0.625rem;
  }
}

#chart-window {
  position: fixed;
  background: rgba(0, 0, 0, 0.8);
  border-radius: 0.9375rem;
  padding: 1.25rem 1.25rem 1.875rem 1.25rem;
  width: 37.5vw;
  height: 31.25vh;
  z-index: 3;
  display: none;
  box-shadow: 0 0.25rem 0.375rem rgba(0, 0, 0, 0.1), 0 0.0625rem 0.1875rem rgba(0, 0, 0, 0.08);
  backdrop-filter: blur(0.625rem);
  -webkit-backdrop-filter: blur(0.5rem);
  color: #fff;
  left: 50vw;
  top: 95vh;
  transform: translate(-50%, -50%);
  overflow: visible;
}

.light-mode #chart-window {
  background: rgba(255, 250, 250, 0.4);
  
}

#chart-window.visible {
  display: block;
}

#chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.9375rem;
  cursor: move;
  user-select: none;
  color: inherit;
}

#chart-title {
  font-weight: bold;
  color: inherit;
}

#chart-time-ranges {
  display: flex;
  gap: 0.3125rem;
  margin-left: 0.625rem;
  flex-wrap: wrap;
}

.time-range-btn {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  color: inherit;
  padding: 0.3125rem 0.5rem;
  border-radius: 0.25rem;
  cursor: pointer;
  font-size: 0.8em;
  transition: background-color 0.3s ease;
  white-space: nowrap;
}

.light-mode .time-range-btn {
  background: rgba(0, 0, 0, 0.1);
}

.time-range-btn:hover {
  background: rgba(255, 255, 255, 0.2);
}

.light-mode .time-range-btn:hover {
  background: rgba(0, 0, 0, 0.2);
}

.time-range-btn.active {
  background: rgba(76, 175, 80, 0.5);
  color: #fff;
}

.light-mode .time-range-btn.active {
  background: rgba(76, 175, 80, 0.7);
  color: #fff;
}

#close-chart {
  background: none;
  border: none;
  color: inherit;
  font-size: 1.5em;
  cursor: pointer;
  padding: 0;
  line-height: 1;
}

#close-chart:hover {
  color: #ff4444;
}

.light-mode #close-chart:hover {
  color: #ff0000;
}

#price-chart {
  width: 100%;
  height: calc(100% - 3.75rem);
  margin-top: 0.625rem;
  overflow: visible;
  padding-bottom: 1.25rem;
}

.light-mode #chart-window {
  background: rgba(255, 255, 255, 0.8);
  color: #000;
}

@media (max-width: 600px) {
  #chart-window {
    width: 90vw;
    height: 28.125vh;
    padding: 0.9375rem 0.9375rem 1.5625rem 0.9375rem;
  }
  
  #chart-time-ranges {
    gap: 0.1875rem;
  }
  
  .time-range-btn {
    padding: 0.25rem 0.375rem;
    font-size: 0.7em;
  }
}

p {
  font-size: .75rem;


}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.dots.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.birds.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.clouds.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.cells.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
</head>
<body>
<div id="background-canvas"></div>
<div id="data-window">
  <h2><b>Crypto Prices</b></h2>  
  <p>Double click a ticker to pull up the chart.</p>
  <div class="price-container selected" id="eth-container">
    <div class="live-ping" id="eth-ping"></div>
    <h1 id="eth-price">ETH: Loading...</h1>
    <span class="price-ticker" id="eth-ticker"></span>
  </div>
  <div class="price-container" id="btc-container">
    <div class="live-ping" id="btc-ping"></div>
    <h1 id="btc-price">BTC: Loading...</h1>
    <span class="price-ticker" id="btc-ticker"></span>
  </div>
  <div class="price-container" id="sol-container">
    <div class="live-ping" id="sol-ping"></div>
    <h1 id="sol-price">SOL: Loading...</h1>
    <span class="price-ticker" id="sol-ticker"></span>
  </div>
  <button id="history-toggle">Show History ▼</button>
  <div id="price-history"></div>
</div>
<select id="background-select">
  <option value="globe" selected>Globe</option>
  <option value="waves">Waves</option>
  <option value="dots">Dots</option>
  <option value="birds">Birds</option>
  <option value="cells">Cells</option>
  <option value="clouds">Clouds</option>
</select>
<button id="dark-mode-toggle">Light Mode</button>
<div id="chart-window" class="hidden">
  <div id="chart-header">
    <div style="display: flex; align-items: center;">
      <span id="chart-title">Price Chart</span>
      <div id="chart-time-ranges">
        <button class="time-range-btn active" data-range="10m">10m</button>
        <button class="time-range-btn" data-range="1h">1h</button>
        <button class="time-range-btn" data-range="6h">6h</button>
        <button class="time-range-btn" data-range="24h">24h</button>
        <button class="time-range-btn" data-range="1y">1y</button>
      </div>
    </div>
    <button id="close-chart">×</button>
  </div>
  <canvas id="price-chart"></canvas>
</div>
<script>
const API_URL = "https://min-api.cryptocompare.com/data/pricemultifull?fsyms=ETH,BTC,SOL&tsyms=USD";
const HISTORY_API_URL = "https://min-api.cryptocompare.com/data/v2/histominute?fsym=ETH&tsym=USD&limit=10";

const ethPriceElement = document.getElementById("eth-price");
const btcPriceElement = document.getElementById("btc-price");
const solPriceElement = document.getElementById("sol-price");
const historyElement = document.getElementById("price-history");
const backgroundSelect = document.getElementById("background-select"); 
const darkModeToggle = document.getElementById("dark-mode-toggle");
const dataWindow = document.getElementById("data-window");
const ethPing = document.getElementById("eth-ping");
const btcPing = document.getElementById("btc-ping");
const solPing = document.getElementById("sol-ping");
const ethTicker = document.getElementById("eth-ticker");
const btcTicker = document.getElementById("btc-ticker");
const solTicker = document.getElementById("sol-ticker");
const ethContainer = document.getElementById("eth-container");
const btcContainer = document.getElementById("btc-container");
const solContainer = document.getElementById("sol-container");
const historyToggle = document.getElementById("history-toggle");
const priceHistory = document.getElementById("price-history");
const chartWindow = document.getElementById("chart-window");
const chartHeader = document.getElementById("chart-header");
const closeChart = document.getElementById("close-chart");
const priceChart = document.getElementById("price-chart");
const chartTimeRanges = document.getElementById("chart-time-ranges");
let vantaEffect;
let prevPrices = {
  ETH: null,
  BTC: null,
  SOL: null
};
let selectedCoin = 'ETH';
let chart = null;
let currentTimeRange = "24h";
let chartUpdateInterval;

async function fetchPrices() {
  const response = await fetch(API_URL);
  const data = await response.json();
  return data;
}

async function fetchHistory(coin, timeRange = "10m") {
  let limit, endpoint;
  
  switch(timeRange) {
    case "10m":
      limit = 10;
      endpoint = "histominute";
      break;
    case "1h":
      limit = 60;
      endpoint = "histominute";
      break;
    case "6h":
      limit = 36;
      endpoint = "histohour";
      break;
    case "24h":
      limit = 24;
      endpoint = "histohour";
      break;
    case "1y":
      limit = 365;
      endpoint = "histoday";
      break;
  }

  const response = await fetch(`https://min-api.cryptocompare.com/data/v2/${endpoint}?fsym=${coin}&tsym=USD&limit=${limit}`);
  const data = await response.json();
  return data.Data.Data;
}

function updateGlobeColor(prices) {
  const ethChange = prices.RAW.ETH.USD.CHANGEPCT24HOUR;
  const btcChange = prices.RAW.BTC.USD.CHANGEPCT24HOUR;
  const solChange = prices.RAW.SOL.USD.CHANGEPCT24HOUR;

  const overallChange = ethChange + btcChange + solChange;

  if (vantaEffect && vantaEffect instanceof VANTA.GLOBE) {
    vantaEffect.setOptions({
      color2: overallChange >= 0 ? 0x4CAF50 : 0xFF5722 // Green if up, Red if down
    });
  }
}

function updatePrices(prices) {
  const ethData = prices.RAW.ETH.USD;
  const btcData = prices.RAW.BTC.USD;
  const solData = prices.RAW.SOL.USD;

  ethPriceElement.innerText = `ETH: $${ethData.PRICE.toFixed(2)}`;
  btcPriceElement.innerText = `BTC: $${btcData.PRICE.toFixed(2)}`;
  solPriceElement.innerText = `SOL: $${solData.PRICE.toFixed(2)}`;

  ethPing.style.display = 'block';
  btcPing.style.display = 'block';
  solPing.style.display = 'block';

  ['ETH', 'BTC', 'SOL'].forEach(coin => {
    const data = prices.RAW[coin].USD;
    const prevPrice = prevPrices[coin];
    const ticker = document.getElementById(`${coin.toLowerCase()}-ticker`);
    const change24h = data.CHANGEPCT24HOUR.toFixed(2);
    const changeSymbol = change24h >= 0 ? '▲' : '▼';
    const changeClass = change24h >= 0 ? 'up' : 'down';

    ticker.innerText = `${changeSymbol} ${Math.abs(change24h)}%`;
    ticker.className = `price-ticker ${changeClass}`;

    prevPrices[coin] = data.PRICE;
  });

  updateGlobeColor(prices); // Update globe color based on overall change
}

function updateHistory(history) {
  historyElement.innerHTML = history.map(item => {
    const date = new Date(item.time * 1000);
    return `<div class="history-item">${date.toLocaleTimeString()}: $${item.close.toFixed(2)}</div>`;
  }).join("");
}

function setBackground(type) {
  if(vantaEffect) vantaEffect.destroy();

  const options = {
    el: "#background-canvas",
    mouseControls: true,
    touchControls: true,
    gyroControls: true,
    minHeight: 200.00,
    minWidth: 200.00,
  };

  switch(type) {
    case "waves":
      vantaEffect = VANTA.WAVES({
        ...options,
        scale: 1.00,
        scaleMobile: 1.00,
        color: 0x000000,
        shininess: 50.00,
        waveHeight: 15.00,
        waveSpeed: 0.70,
        zoom: 0.8
      });
      break;
    case "dots":
      vantaEffect = VANTA.DOTS({
        ...options,
        color: 0xffffff,
        color2: 0xffffff,
        backgroundColor: 0x000000,
        spacing: 23.00,
        size: 2.70 
      });
      break;
    case "birds":
      vantaEffect = VANTA.BIRDS({
        ...options,
        backgroundColor: 0x000000,
        color1: 0xffffff,
        color2: 0xff000c,
        color3: 0x9860df,
        colorMode: "lerp",
        quantity: 3.00
      });
      break;
    case "clouds":
      vantaEffect = VANTA.CLOUDS({
        ...options,
        backgroundColor: 0xffffff,
        skyColor: 0xfabaff,
        cloudColor: 0xffe5ff,
        cloudShadowColor: 0x2a628f,
        sunGradient: false,
        sunPosition: 0.5,
        speed: 0.8
      });
      break;
    case "cells":
      vantaEffect = VANTA.CELLS({
        ...options,
        color1: 0x000000,
        color2: 0xffffff,
        size: 1.4,
        speed: 1.7
      });
      break; 
    case "globe":
      vantaEffect = VANTA.GLOBE({
        ...options,
        backgroundColor: 0x000000,
        color: 0xffffff,
        color2: 0xff000c,
        size: 0.9,
        distance: 250
      });
      break;
  }
}

function toggleDarkMode() {
  dataWindow.classList.toggle('light-mode');
  if(dataWindow.classList.contains('light-mode')) {
    darkModeToggle.innerText = 'Dark Mode';
  } else {
    darkModeToggle.innerText = 'Light Mode';
  }
}

function toggleHistory() {
  priceHistory.classList.toggle('expanded');
  historyToggle.innerText = priceHistory.classList.contains('expanded') ? 'Hide History ▲' : 'Show History ▼';
}

function handleCoinClick(coin) {
  return async function() {
    selectedCoin = coin;
    ethContainer.classList.remove('selected');
    btcContainer.classList.remove('selected');
    solContainer.classList.remove('selected');
    document.getElementById(`${coin.toLowerCase()}-container`).classList.add('selected');
    const history = await fetchHistory(coin, currentTimeRange);
    updateHistory(history.reverse());
  }
}

function dragMoveListener(event) {
  const target = event.target;
  const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
  const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

  target.style.left = `${x}px`;
  target.style.top = `${y}px`;
  target.setAttribute('data-x', x);
  target.setAttribute('data-y', y);
}

function createChart(coin, data, timeRange) {
  const labels = data.map(item => formatTimeLabel(item.time, timeRange));
  const prices = data.map(item => item.close);

  if (chart) {
    // Update existing chart
    chart.data.labels = labels;
    chart.data.datasets[0].data = prices;
    chart.data.datasets[0].label = `${coin} Price (USD)`; // Update the dataset label
    chart.update();
    return;
  }

  const ctx = priceChart.getContext('2d');

  // Adjust chart options based on time range
  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: true,
        position: 'top',
        labels: {
          color: dataWindow.classList.contains('light-mode') ? '#000' : '#fff'
        }
      },
      tooltip: {
        mode: 'index',
        intersect: false,
        callbacks: {
          label: function(context) {
            return `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`;
          }
        }
      }
    },
    scales: {
      y: {
        beginAtZero: false,
        grid: {
          color: dataWindow.classList.contains('light-mode') ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)'
        },
        ticks: {
          color: dataWindow.classList.contains('light-mode') ? '#000' : '#fff',
          callback: function(value) {
            return '$' + value.toFixed(2);
          }
        }
      },
      x: {
        grid: {
          color: dataWindow.classList.contains('light-mode') ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)'
        },
        ticks: {
          color: dataWindow.classList.contains('light-mode') ? '#000' : '#fff',
          maxRotation: timeRange === "1y" ? 90 : 45,
          minRotation: timeRange === "1y" ? 90 : 45,
          // For 1 year view, show fewer labels to prevent overcrowding
          maxTicksLimit: timeRange === "1y" ? 12 : undefined
        }
      }
    }
  };

  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: `${coin} Price (USD)`,
        data: prices,
        borderColor: '#4CAF50',
        backgroundColor: 'rgba(76, 175, 80, 0.1)',
        borderWidth: 2,
        fill: true,
        tension: 0.4
      }]
    },
    options: chartOptions
  });
}

function startChartUpdate(coin) {
  if (chartUpdateInterval) {
    clearInterval(chartUpdateInterval);
  }
  chartUpdateInterval = setInterval(async () => {
    if (chartWindow.classList.contains('visible')) {
      const history = await fetchHistory(coin, currentTimeRange);
      createChart(coin, history, currentTimeRange);
    }
  }, 10000); // Update every 10 seconds
}

function stopChartUpdate() {
  if (chartUpdateInterval) {
    clearInterval(chartUpdateInterval);
    chartUpdateInterval = null;
  }
}

async function showChart(coin) {
  const history = await fetchHistory(coin, currentTimeRange);
  createChart(coin, history, currentTimeRange);
  document.getElementById("chart-title").textContent = `${coin} Chart`;
  chartWindow.classList.add("visible");
  startChartUpdate(coin);
  
  // Get the main data window position
  const dataWindow = document.getElementById("data-window");
  const dataWindowRect = dataWindow.getBoundingClientRect();
  
  // Calculate the center position
  const chartWidth = chartWindow.offsetWidth;
  const chartHeight = chartWindow.offsetHeight;
  
  // Center horizontally relative to the data window
  const centerX = dataWindowRect.left + (dataWindowRect.width / 2) - (chartWidth / 2);
  // Position at 70% from top
  const topY = window.innerHeight * 0.7 - (chartHeight / 2);
  
  // Set initial position using fixed positioning
  chartWindow.style.left = `${centerX}px`;
  chartWindow.style.top = `${topY}px`;
  chartWindow.style.transform = 'none'; // Remove the default transform
  chartWindow.setAttribute('data-x', centerX);
  chartWindow.setAttribute('data-y', topY);
}

function closeChartWindow() {
  chartWindow.classList.remove("visible");
  stopChartUpdate();
  if (chart) {
    chart.destroy();
    chart = null;
  }
  // Reset position
  chartWindow.style.left = '';
  chartWindow.style.top = '';
  chartWindow.style.transform = 'translate(-50%, -50%)'; // Restore default transform
  chartWindow.removeAttribute('data-x');
  chartWindow.removeAttribute('data-y');
}

async function updateChartTimeRange(coin, timeRange) {
  currentTimeRange = timeRange;
  const history = await fetchHistory(coin, timeRange);
  createChart(coin, history, timeRange);
}

function formatTimeLabel(timestamp, timeRange) {
  const date = new Date(timestamp * 1000);
  if (timeRange === "10m" || timeRange === "1h") {
    return date.toLocaleTimeString();
  } else if (timeRange === "6h" || timeRange === "24h") {
    return date.toLocaleString();
  } else if (timeRange === "1y") {
    return date.toLocaleDateString();
  }
}

async function init() {
  const prices = await fetchPrices();
  const history = await fetchHistory(selectedCoin, currentTimeRange);
  
  updatePrices(prices);
  updateHistory(history.reverse());

  setBackground(backgroundSelect.value);

  backgroundSelect.addEventListener("change", (e) => {
    setBackground(e.target.value);
  });

  darkModeToggle.addEventListener('click', toggleDarkMode);
  historyToggle.addEventListener('click', toggleHistory);

  ethContainer.addEventListener('dblclick', handleCoinClick('ETH'));
  btcContainer.addEventListener('dblclick', handleCoinClick('BTC'));
  solContainer.addEventListener('dblclick', handleCoinClick('SOL'));

  setInterval(async () => {
    const prices = await fetchPrices();
    updatePrices(prices);
  }, 10000);

  setInterval(async () => {
    const history = await fetchHistory(selectedCoin, currentTimeRange);  
    updateHistory(history.reverse());
  }, 60000);

  // Initialize interact.js for dragging
  interact(chartWindow)
    .draggable({
      inertia: true,
      modifiers: [
        interact.modifiers.restrictRect({
          restriction: 'parent',
          endOnly: true
        })
      ],
      autoScroll: true,
      listeners: {
        move: dragMoveListener
      }
    });

  closeChart.addEventListener("click", closeChartWindow);

  [ethContainer, btcContainer, solContainer].forEach(container => {
    container.addEventListener("dblclick", async (e) => {
      const coin = e.currentTarget.id.split("-")[0].toUpperCase();
      await showChart(coin);
    });
  });

  chartTimeRanges.addEventListener("click", async (e) => {
    if (e.target.classList.contains("time-range-btn")) {
      const timeRange = e.target.dataset.range;
      const coin = document.getElementById("chart-title").textContent.split(" ")[0];
      
      document.querySelectorAll(".time-range-btn").forEach(btn => {
        btn.classList.remove("active");
      });
      e.target.classList.add("active");
      
      await updateChartTimeRange(coin, timeRange);
    }
  });

  // Update the default active button for the time range
  chartTimeRanges.querySelectorAll(".time-range-btn").forEach(btn => {
    btn.classList.remove("active");
    if (btn.dataset.range === "24h") {
      btn.classList.add("active");
    }
  });
}

init();
</script>
</body>
</html>
